# Angular Training Unit 1

This branch includes a cleaned up version of the standard Angular project generated by `ng new`,
which we'll use as the basis for our entire training.

## Getting and displaying data

Generally speaking, Angular applications are made up of _components_ and _services_; 
components are about presenting data and interacting with the user, 
while services incorporate the application's business logic, including obtaining 
data from some external source and processing it.

We want now to retrieve some data to display, so we'll query a public API returning
a list of registered on GitHub: `https://api.github.com/organizations?per_page={limit}`.
In Angular, one creates a service for that; we will then _inject_ that service 
where it's required.

## The GitHub organizations service
 
Run the following command from the command line:
```text
ng generate service GitHubOrganizations
```
It will generate class `GitHubOrganizationsService` in 
_src/app/git-hub-organizations.service.ts_ and its test counterpart, 
_src/app/git-hub-organizations.service.specs.ts_. 

We edit _git-hub-organizations.service.ts_:
```typescript
import {Injectable} from '@angular/core';
import {HttpClient} from '@angular/common/http';

@Injectable({
    providedIn: 'root'
})
export class GitHubOrganizationsService {

    constructor( private httpClient: HttpClient ) {
    }

    fetchOrganizations( count: number ): void {
        const url = 'https://api.github.com/organizations?per_page=' + count;
        this.httpClient.get( url )
            .toPromise()
            .then(  data  => console.log(   JSON.stringify( data  )))
            .catch( error => console.error( JSON.stringify( error )));
    }
}
```

Our service requires module `HttpClient`, which needs to be imported into the application (_app-module.ts_):

```typescript
import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';
import { AppComponent } from './app.component';
import { HttpClientModule } from '@angular/common/http';

@NgModule({
  declarations: [
    AppComponent
  ],
  imports: [
    BrowserModule,
    HttpClientModule
  ],
  providers: [ HttpClientModule ],
  bootstrap: [ AppComponent ]
})
export class AppModule { }
```

We are now ready to inject the service in our component class and invoke its `fetchOrganizations()`
method in the component's initialization phase (_app.component.ts_):

```angular2html
export class AppComponent implements OnInit {

    constructor( private gitHubOrganizationsService: GitHubOrganizationsService ) {
    }

    ngOnInit(): void {
        this.gitHubOrganizationsService.fetchOrganizations( 3 );
    }
}
```

If we navigate to http://localhost:4200/ and open the browser's console we should
see a JSON array of GitHub organizations. The network view should show an HTTP request to
the GitHub organizations URL every time we reload the application.

## Displaying data on the browser tab

We now bring that data to the browser. First we need to find a place for it in the HTML template, 
which will be rendered as HTML (_app.component.html_):

```angular2html
<pre>{{ gitHubOrganizations }}</pre>
```

Then we need to change the service to return the data to its caller instead of logging it to 
the console, introducing a callback function (_git-hub-organizations.service.ts_):

```typescript
    fetchOrganizations( count: number,
                        callback: (data: any) => void  ): void {
        const url = 'https://api.github.com/organizations?per_page=' + count;
        this.httpClient.get( url )
            .toPromise()
            .then(  data  => callback( data ))
            .catch( error => console.error( JSON.stringify( error )));
    }
```

Finally, we provide that callback in the component class (_app.component.ts_):

```typescript
    gitHubOrganizations: string;
    ...
    ngOnInit(): void {
        this.gitHubOrganizationsService.fetchOrganizations(
            3,
            (organizations) => this.gitHubOrganizations = JSON.stringify(organizations, undefined, 4 )
        );
    }
```

If we navigate to http://localhost:4200/ we should
see a JSON array of GitHub organizations.

## Type safety

TypeScript is a (somewhat) type-safe superset of JavaScript, and we should take advantage of that to
make our applications more robust. Types are defined as _interfaces_ in TS, and we can define a GitHub
organization as such:
```text
ng generate interface GitHubOrganization
```

...and populate it (_git-hub-organization.ts_):

```typescript
export interface GitHubOrganization {
    login: string;
    id: number;
    node_id: string;
    url: string;
    repos_url: string;
    events_url: string;
    hooks_url: string;
    issues_url: string;
    members_url: string;
    public_members_url: string;
    avatar_url: string;
    description: string;
}
```

The interface represents part of the contract between the service (data provider) and the component (data consumer).
We change the service definition first (_git-hub-organizations.service.ts_):

```typescript
    fetchOrganizations( count: number,
                        callback: (data: GitHubOrganization[]) => void  ): void {
    const url = 'https://api.github.com/organizations?per_page=' + count;
    this.httpClient.get<GitHubOrganization[]>( url )
        .toPromise()
        .then(  data  => callback( data ))
        .catch( error => console.error( JSON.stringify( error )));
}
```

...and then the caller (_app.component.ts_):

```typescript
    ngOnInit(): void {
        this.gitHubOrganizationsService.fetchOrganizations(
            3,
            (organizations: GitHubOrganization[]) => this.gitHubOrganizations = JSON.stringify( organizations, undefined, 4 )
        );
    }
```

## Polishing

We hardcoded the URL of the GitHub organizations API in the service method.
In real life you will probably have  a test server that's different from your 
production server, and you can take advantage of Angular _environments_ to 
differentiate at build time.

**NOTE** ALMA conventions are different and that configuration happens at runtime.

We'll use the same API URL in "development" (_environments/environment.ts_) and in "production" 
(_environments/environment.prod.ts_): 
```typescript
  gitHubApiUrl: 'https://api.github.com'
```

...and we'll inject that value in the service (_git-hub-organizations.service.ts_):

```typescript
    import {environment} from '../environments/environment';
    ...
    const url = environment.gitHubApiUrl + '/organizations?per_page=' + count;
```

A development or production environment will be chosen at build time, based on command-line
options, see [the Angular build guide](https://angular.io/guide/build).
